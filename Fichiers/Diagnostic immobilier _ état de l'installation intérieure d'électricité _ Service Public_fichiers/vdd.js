define(["jquery","vddTooltip","global","entreprendre/marquage","persoGeo"],function(t,e,o,i,a){"use strict";function n(e){t("abbr[data-"+e+"], span[data-"+e+"]").each(function(){var o=t(this).data()[e],i=t(this).data().id,a=this,n=t("div[data-"+e+"="+o+"]"),r=n.first().text();a.setAttribute("data-original-title",r),t(a).children("span#tooltip-"+i).text(r)})}return{initPersoGeo:function(){t("[data-application=geoSearchForm]").each(function(e,o){a.execute(t(o))})},loadInfoBulleDefinitionTooltip:function(){n("definition")},loadTooltip:function(){t('[data-toggle="tooltip"]').tooltip({trigger:"focus",placement:"bottom",html:!0}).on("mouseenter",function(){var e=this;t(this).tooltip("show"),t(".tooltip").on("mouseleave",function(){t(e).tooltip("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){t(".tooltip:hover").length||t(e).tooltip("hide")},300)}),t(document).on("keyup",function(e){"Escape"!==e.key&&27!==e.keyCode||t(".tooltip.show").remove()})},initFocusInterlocuteur:function(){t("button[data-js=focusPosition]").on("click",function(){t(document).ready(function(){t('input[name="searchedCity"]').focus()})})},setFocusOnBlockAlert:function(){t('[role="alert"]').focus()},loadInfoBulleAbreviation:function(){n("sigle"),n("acronyme")},initFormContactErrorHandle:function(){var e=new RegExp("^[_A-Za-z0-9-\\+-]+(\\.[_A-Za-z0-9-\\+-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9-\\+-]+)*(\\.[A-Za-z]{2,})$"),o=!0,i=!1;t("#submitContactForm").click(function(e){o=!0,i=!1,s(),c(),u(),p(),d(),f(),e.preventDefault(),o&&t("form#contactForm").submit()});var a=function(t){t.attr("hidden",!1).attr("aria-hidden",!1)},n=function(t){t.attr("hidden",!0).attr("aria-hidden",!0)},r=function(e,o,n,r){var l=t("#"+e);a(l),l.addClass("fr-error-text"),l.text(r),t("#"+n).addClass("fr-input-group--error");var s=t("#"+o);s.addClass("fr-input--error"),s.attr("aria-describedby",e),i||(i=!0,s.focus())},l=function(e,o,i){var a=t("#"+e);n(a),a.removeClass("fr-error-text"),a.text(""),t("#"+i).removeClass("fr-input-group--error");var r=t("#"+o);r.removeClass("fr-input--error"),r.removeAttr("aria-describedby")},s=function(){l("subject-error","subject","fr-input-group-subject"),t("#subject").val()||(r("subject-error","subject","fr-input-group-subject","Veuillez complétez ce champ"),o=!1)},c=function(){l("message-error","message","fr-input-group-message"),t("#message").val()||(r("message-error","message","fr-input-group-message","Veuillez complétez ce champ"),o=!1)},u=function(){l("email-error","email","fr-input-group-email");var i=t("#email");e.test(i.val())&&i.val()||(r("email-error","email","fr-input-group-email","Veuillez saisir une adresse valide, exemple : nathalie.martin@exemple.com"),o=!1)},p=function(){l("confirmationEmail-error","confirmationEmail","fr-input-group-confirmationEmail"),t("#email").val()!==t("#confirmationEmail").val()?(r("confirmationEmail-error","confirmationEmail","fr-input-group-confirmationEmail","Les deux adresses email ne sont pas identiques"),o=!1):t("#email").val()||t("#confirmationEmail").val()||r("confirmationEmail-error","confirmationEmail","fr-input-group-confirmationEmail","Veuillez saisir une adresse valide, exemple : nathalie.martin@exemple.com")},d=function(){l("postalCode-error","postalCode","fr-input-group-postalCode"),t("#postalCode").val()||(r("postalCode-error","postalCode","fr-input-group-postalCode","Veuillez complétez ce champ"),o=!1)},f=function(){l("conditions-utilisation-error","conditions-utilisation","conditions-utilisation-group"),!1===t("#conditions-utilisation").prop("checked")&&(r("conditions-utilisation-error","conditions-utilisation","conditions-utilisation-group","Veuillez cocher cette case"),o=!1)}},onUncollapseAllHandler:function(e){console.log("vdd.js initCollapseUncollapse click onUncollapseAllHandler");var o,a=t(e.currentTarget);o=t(e.currentTarget).parents().is("[role='tabpanel']")?a.parents("[role='tabpanel']"):t(e.currentTarget).parents().hasClass("tab-pane")?a.parents(".tab-pane"):a.parents("article"),i.disableXitiReport(),o.find("div[data-toggle-scope] button[data-toggle=collapse]").filter(function(){var e=o.find(t(this).data("target"));return e&&e.hasClass("collapse")&&e.hasClass("show")}).click(),i.enableXitiReport()},onCollapseAllHandler:function(e){console.log("vdd.js initCollapseUncollapse click onCollapseAllHandler");var o,a,n=t(e.currentTarget);o=t(e.currentTarget).parents().is("[role='tabpanel']")?n.parents("[role='tabpanel']"):t(e.currentTarget).parents().hasClass("tab-pane")?n.parents(".tab-pane"):n.parents("article"),i.disableXitiReport(),a=o.find("div[data-toggle-scope] button[data-toggle='collapse']"),a.filter(function(){var e=t(this).parents(".collapse"),i=!1;if(e.each(function(){o.find(t(this)).length>0&&(i=!0)}),i)return!1;var a=o.find(t(this).data("target"));return a&&a.hasClass("collapse")&&!a.hasClass("show")}).click(),i.enableXitiReport()},initCollapseUncollapse:function(){console.log("vdd.js initCollapseUncollapse");var e=t(".btn-fold"),o=t(".btn-unfold");e.on("click",this.onUncollapseAllHandler),o.on("click",this.onCollapseAllHandler)},initShowExpiredArticle:function(){t("button[data-show=expiredArticle]").on("click",function(){var e=t(".block-show-more");e.show(400),e.attr("aria-hidden","false"),e.removeAttr("hidden"),e.first().attr("tabindex","-1"),e.focus(),t(this).hide(),t(this).attr("aria-hidden","true")})}}});