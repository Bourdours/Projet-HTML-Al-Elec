define(["jquery","modalHelper","entreprendre/marquage","cookies","global"],function(t,e,s,a,i){"use strict";var r=function(e,a){var r=t("[data-id=subscribe_"+a+"]");r.prop("disabled",!0),s.makeCall("[data-id=subscribe_"+a+"]");var o=0===a.indexOf("A"),c=o?"actualites":"vosdroits",l=null;l=document.location.href.indexOf("entreprendre.")>-1?"/"+c+"/"+a+"/abonnement":"/"+e+"/"+c+"/"+a+"/abonnement",t.ajax({method:"POST",url:l,dataType:"json"}).done(function(e,s,a){if(t(window).scrollTop(0),o){if(204===a.status)return n(t("#subscription_no_content_alert"));t("#subscription_succeeded_sujet").text(e)}return t("#sp-btn-abonnement").attr("aria-controls","subscription_succeeded_alert"),t("#sp-btn-abonnement").attr("data-target","#subscription_succeeded_alert"),n(t("#subscription_succeeded_alert"))}).fail(function(e){if(t(window).scrollTop(0),401===e.status)return void(window.location.href=t("#subscription_warning_alert").find("a[data-control-lastlink]").attr("href"));if(403===e.status){var s=i.getCsrfHeader(),a=t("#subscription_warning_alert_asso");return t('input[name="_csrf"]',a).attr("value",s.token),n(a)}return n(t("#subscription_error_alert"))}).always(function(){r.prop("disabled",!1),t("[data-control-toolbar-content-close]").focus()})},n=function(e){var s=e.is(":visible");if([t("#subscription_succeeded_alert"),t("#subscription_no_content_alert"),t("#subscription_warning_alert"),t("#subscription_warning_alert_asso"),t("#subscription_error_alert"),t("#alerte-fiche-F")].forEach(function(t){t.attr("aria-hidden",!0).attr("hidden","hidden").hide(),t.hasClass("show")&&t.removeClass("show")}),s)t("#"+e.attr("aria-labelledby")).attr("aria-expanded",!1).focus();else{e.attr("aria-hidden",!1).attr("hidden",!1).show();var a=t("#"+e.attr("aria-labelledby"));a.attr("aria-expanded",!0),a.attr("data-target","#"+e.attr("id")),a.attr("aria-controls",e.attr("id")),e.focus(),e.find("[data-control-toolbar-content-close]").removeAttr("aria-expanded").focus()}},o=function(e,s,a,i){t("[data-test=success-alert]")&&t("[data-test=success-alert]").focus(),t("[data-test=success-alert-fiche]")&&t("[data-test=success-alert-fiche]").focus(),l("#suivimajExampleModal"),l("#expirationDocExampleMailModal"),l("#alertSuiviDemarche"),l("#suiviAlerteActuExampleModal"),t("[data-id=subscribe_"+s+"]").click(function(){n(t("#subscription_warning_alert"))}),t("#subscription_warning_alert").find("a[data-control-lastlink]").click(function(t){t.preventDefault(),this.subscribe(e,s)}.bind(this)),a&&n(t("#subscription_succeeded_alert")),i&&n(t("#subscription_warning_alert_asso")),b()},c=function(e,s,a,i,r){t("[data-test=success-alert]")&&t("[data-test=success-alert]").focus(),t("[data-test=success-alert-fiche]")&&t("[data-test=success-alert-fiche]").focus(),l("#suivimajExampleModal"),l("#expirationDocExampleMailModal"),l("#alertSuiviDemarche"),t("[data-id=subscribe_"+s+"]").click(function(){n(t("#subscription_warning_alert"))}),t("#subscription_warning_alert").find("a[data-control-lastlink]").click(function(t){t.preventDefault(),this.subscribe(e,s)}.bind(this)),a&&n(t(204===r?"#subscription_no_content_alert":"#subscription_succeeded_alert")),i&&n(t("#subscription_warning_alert_asso")),b()},l=function(s){t('button[data-target="'+s+'"]').click(function(){e.setupFocus(s)})},u=function(){if(t("#see-more-or-less-subscriptions").text("Afficher moins d'abonnements aux mises à jour"),t("ul#subscriptions-list > li").attr("aria-hidden","false"),t("ul#subscriptions-list > li").removeClass("hide"),t("ul#subscriptions-list > li").length>9){var e=t("div.bloc-abo-content > h5:eq(10)");e.attr("tabindex","-1"),e.focus()}},d=function(){t("#see-more-or-less-subscriptions").text("Afficher plus d'abonnements aux mises à jour"),t("ul#subscriptions-list li").each(function(e){if(e>9){t(this).attr("aria-hidden","true"),t(this).addClass("hide");t("div.bloc-abo-content > h5:eq(10)").removeAttr("tabindex")}})},b=function(){t("#see-more-or-less-subscriptions").click(function(e){e.preventDefault(),0===t("ul#subscriptions-list li[aria-hidden=true]").length?d():u()}.bind(this))};return{subscribe:r,setUpActu:c,setUp:o}});